# TTS 示例程序

本目录包含基于 Sherpa-onnx 的 TTS（文本到语音）示例程序，支持多种输出模式。

## 功能特性

- 支持四种输出模式
- 支持 ALSA 音频设备输出
- 支持 WAV 文件输出
- 支持分块实时输出
- 命令行参数配置

## 编译

```bash
make
```

## 输出模式

程序支持以下四种输出模式：

| 模式编号 | 模式名称 | 说明 |
|---------|---------|------|
| 1 | 单次输出到文件 | 等所有音频生成完成后，一次性写入 WAV 文件 |
| 2 | 单次输出到 ALSA | 等所有音频生成完成后，一次性播放 |
| 3 | 分块输出到文件 | 每生成一块音频就立即写入文件 |
| 4 | 分块输出到 ALSA | 每生成一块音频就立即播放（推荐） |

## 命令行参数

| 参数 | 简写 | 默认值 | 说明 |
|-----|------|--------|------|
| `--mode` | `-m` | 1 | 输出模式 (1-4) |
| `--text` | `-t` | 预设文本 | 要合成的文本 |
| `--output` | `-o` | generated.wav | 输出 WAV 文件名 |
| `--device` | `-d` | - | ALSA 音频设备 (必须指定) |
| `--help` | `-h` | - | 显示帮助信息 |

## 使用示例

### 1. 使用默认设置（模式1：单次输出到文件）

```bash
./tts_test
```

### 2. 分块输出到指定 ALSA 设备

```bash
./tts_test -m 4 -d hw:5,0
```

### 3. 使用自定义文本和输出文件

```bash
./tts_test -m 3 -t "你好世界，这是一段测试语音。" -o output.wav
```

## 查看可用 ALSA 设备

使用以下命令查看可用的音频设备：

```bash
aplay -l
```

根据输出结果确定设备编号，例如 `card 5, device 0` 对应的设备为 `hw:5,0`。

## 模型配置

模型文件位于当前目录的 tts/ 子目录下：
- MatchaTTS 声学模型
- Vocos 声码器
- 词典和 token 文件

配置详见 `sherpa_tts.c`。
